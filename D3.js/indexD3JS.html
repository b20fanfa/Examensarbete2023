<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3.js with dataset</title>
    <link rel="stylesheet" href="styleD3.css"></link>

  </head>
  <body>
    <h1>D3.js </h1>

    <script type="module">
      import { MAPS_API_KEY} from "../Heatmap.js/APIkey.js"
      const APIkey = MAPS_API_KEY;
       // Create the script tag, set the appropriate attributes, 
       var script1 = document.createElement('script');
      script1.src = 'https://maps.googleapis.com/maps/api/js?key=' + APIkey + ' &callback=initMap';
      script1.async = true;
      
      // Append the 'script' element to 'head'. And put the scrip on the website
      document.head.appendChild(script1);
    </script>
   
    <div id="map"></div>
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script>
      function initMap(){
        // Create the Google Mapâ€¦
        var map = new google.maps.Map(d3.select("#map").node(), {
          zoom: 5,
          center: new google.maps.LatLng(37.76487, -122.41948),
          mapTypeId: google.maps.MapTypeId.TERRAIN
        });

        // Load the station data. When the data comes back, create an overlay.
        d3.json("./dataSetPoint.json", function(error, data) {
          console.log(data);

          var overlay = new google.maps.OverlayView();

          // Add the container when the overlay is added to the map.
          overlay.onAdd = function() {
            var layer = d3.select(this.getPanes().overlayLayer).append("div")
              .attr("class", "stations");

            // Draw each marker as a separate SVG element.
            // Use a SVG, it will all have the same size.
            overlay.draw = function() {
              var projection = this.getProjection(),
              padding = 10;

              var marker = layer.selectAll("svg")
              .data(d3.entries(data))
              .each(transform) // update existing markers
              .enter().append("svg")
              .each(transform)
              .attr("class", "marker");

              // To make a SVG circle.
              marker.append("circle")
              .attr("r", 4.5)
              .attr("cx", padding)
              .attr("cy", padding);

              // Add a label on every datapoint// will remove later
              marker.append("text")
              .attr("x", padding + 7)
              .attr("y", padding)
              .attr("dy", ".31em")
              .text(function(d) { return d.key; });

              function transform(d) {
                d = new google.maps.LatLng(d.value[1], d.value[0]);
                d = projection.fromLatLngToDivPixel(d);
                return d3.select(this)
                .style("left", (d.x - padding) + "px")
                .style("top", (d.y - padding) + "px");
              }
            };
          };
          // Bind the overlay to the map 
          overlay.setMap(map);
        });
      }
    </script>
  </body>
</html>